INCLUDE(InstallRequiredSystemLibraries)

SET(CPACK_NSIS_DISPLAY_NAME "DynaMind")
SET(CPACK_PACKAGE_DESCRIPTION_SUMMARY "DynaMind")
SET(CPACK_PACKAGE_NAME "DynaMind")
SET(CPACK_PACKAGE_VENDOR "University of Innsbruck")
SET(CPACK_PACKAGE_VERSION_MAJOR "0")
SET(CPACK_PACKAGE_VERSION_MINOR "1")
SET(CPACK_PACKAGE_VERSION_PATCH "0")
SET(CPACK_RESOURCE_FILE_LICENSE "${dynamind_SOURCE_DIR}/LICENSE")

IF(UNIX)
    SET(CPACK_GENERATOR "NSIS")
    SET(CPACK_NSIS_DISPLAY_NAME "DynaMind")
    SET(CPACK_NSIS_HELP_LINK "http:\\\\\\\\www.uibk.ac.at")
    SET(CPACK_NSIS_URL_INFO_ABOUT "http:\\\\\\\\www.uibk.ac.at")
    SET(CPACK_NSIS_CONTACT "michael.mair@uibk.ac.at")
    IF(CMAKE_BUILD_TYPE STREQUAL Release)
        FILE(GLOB DLLS  ${QT_BINARY_DIR}/QtCore4.dll
                        ${QT_BINARY_DIR}/QtGui4.dll
                        ${QT_BINARY_DIR}/QtXml4.dll
                        ${QT_BINARY_DIR}/QtXmlPatterns4.dll
                        ${QT_BINARY_DIR}/QtNetwork4.dll
                        ${QT_BINARY_DIR}/QtWebKit4.dll
                        ${QT_BINARY_DIR}/phonon4.dll
                        ${QT_BINARY_DIR}/QtOpenGL4.dll
                        ${QT_BINARY_DIR}/QtSVG4.dll
                        ${QT_BINARY_DIR}/QtSql4.dll
                        ${Boost_LIBRARY_DIRS}/boost_python-*-mt-1_*.dll
                        ${Boost_LIBRARY_DIRS}/boost_system-*-mt-1_*.dll
                        ${Boost_LIBRARY_DIRS}/boost_signals-*-mt-1_*.dll
                        ${Boost_LIBRARY_DIRS}/boost_date_time-*-mt-1_*.dll
                        ${Boost_LIBRARY_DIRS}/boost_filesystem-*-mt-1_*.dll
                        ${Boost_LIBRARY_DIRS}/boost_program_options-*-mt-1_*.dll)
    ENDIF()

    SET(CPACK_NSIS_EXTRA_INSTALL_COMMANDS "
        !include \\\"winmessages.nsh\\\"
        !define env_hklm 'HKLM \\\"SYSTEM\\\\CurrentControlSet\\\\Control\\\\Session Manager\\\\Environment\\\"'
        !define env_hkcu 'HKCU \\\"Environment\\\"'
        WriteRegExpandStr  \\$\\{env_hklm\\} DYNAMIND_DIR $INSTDIR
        SendMessage \\$\\{HWND_BROADCAST\\} \\$\\{WM_WININICHANGE\\} 0 \\\"STR:Environment\\\" /TIMEOUT=5000
        ClearErrors
        ")

     MESSAGE(STATUS ${CPACK_NSIS_EXTRA_INSTALL_COMMANDS})

     SET(CPACK_NSIS_EXTRA_UNINSTALL_COMMANDS "
        DeleteRegValue \\$\\{env_hklm\\} DYNAMIND_DIR
        SendMessage \\$\\{HWND_BROADCAST\\} \\$\\{WM_WININICHANGE\\} 0 \\\"STR:Environment\\\" /TIMEOUT=5000
      ")


  INSTALL(FILES ${DLLS} DESTINATION bin)
  INSTALL(FILES ${QT_BINARY_DIR}/../plugins/sqldrivers/qsqlmysql4.dll DESTINATION bin/plugins/sqldrivers)
ENDIF()
INCLUDE(CPack)
